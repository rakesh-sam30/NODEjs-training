"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.parseEntries = exports.constructFindMD5SearchUrl = exports.constructMD5SearchUrl = exports.constructSearchURL = void 0;
const selectors_1 = __importDefault(require("../selectors"));
function constructSearchURL({ query, pageNumber, pageSize, mirror, searchReqPattern, columnFilterQueryParamKey, columnFilterQueryParamValue, }) {
    let url = searchReqPattern
        .replace("{mirror}", mirror)
        .replace("{query}", query)
        .replace("{pageNumber}", pageNumber.toString())
        .replace("{pageSize}", pageSize.toString());
    if (columnFilterQueryParamValue) {
        url += `&${columnFilterQueryParamKey}=${columnFilterQueryParamValue}`;
    }
    return url;
}
exports.constructSearchURL = constructSearchURL;
function constructMD5SearchUrl(pattern, mirror, md5) {
    return pattern.replace("{mirror}", mirror).replace("{md5}", md5);
}
exports.constructMD5SearchUrl = constructMD5SearchUrl;
function constructFindMD5SearchUrl(pattern, mirror, idList) {
    return pattern.replace("{mirror}", mirror).replace("{id}", idList.join(","));
}
exports.constructFindMD5SearchUrl = constructFindMD5SearchUrl;
function parseEntries(document, throwError) {
    var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l;
    const entries = [];
    const containerTable = document.querySelector(selectors_1.default.TABLE_CONTAINER_SELECTOR);
    if (!containerTable) {
        if (throwError) {
            throwError("containerTable is undefined");
        }
        return;
    }
    // Get rid of table header by slicing it
    const entryElements = Array.from(containerTable.children).slice(1);
    for (let i = 0; i < entryElements.length; i++) {
        const element = entryElements[i];
        const id = ((_a = element.children[0]) === null || _a === void 0 ? void 0 : _a.textContent) || "";
        const authors = ((_b = element.children[1]) === null || _b === void 0 ? void 0 : _b.textContent) || "";
        const title = ((_c = element.children[2]) === null || _c === void 0 ? void 0 : _c.textContent) || "";
        const publisher = ((_d = element.children[3]) === null || _d === void 0 ? void 0 : _d.textContent) || "";
        const year = ((_e = element.children[4]) === null || _e === void 0 ? void 0 : _e.textContent) || "";
        const pages = ((_f = element.children[5]) === null || _f === void 0 ? void 0 : _f.textContent) || "";
        const language = ((_g = element.children[6]) === null || _g === void 0 ? void 0 : _g.textContent) || "";
        const size = ((_h = element.children[7]) === null || _h === void 0 ? void 0 : _h.textContent) || "";
        const extension = ((_j = element.children[8]) === null || _j === void 0 ? void 0 : _j.textContent) || "";
        const mirror = ((_l = (_k = element.children[9]) === null || _k === void 0 ? void 0 : _k.children[0]) === null || _l === void 0 ? void 0 : _l.getAttribute("href")) || "";
        entries.push({
            id,
            authors,
            title,
            publisher,
            year,
            pages,
            language,
            size,
            extension,
            mirror,
        });
    }
    return entries;
}
exports.parseEntries = parseEntries;
